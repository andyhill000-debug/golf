<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#0a0a0a"/>
<title>Hillfred Golf ¬∑ Live Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
  :root{--teal:#00e8bb;--gold:#e2b84a;--red:#ff5a5a;--bg:#0a0a0a;--card:#141414;--border:#222;--text:#f0f0f0;--muted:#555;}
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;}

  /* Header */
  .header{background:#0f0f0f;border-bottom:1px solid var(--border);padding:13px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
  .header-left{display:flex;align-items:center;gap:12px;}
  .back-btn{display:flex;align-items:center;gap:6px;background:rgba(0,232,187,.08);border:1.5px solid rgba(0,232,187,.25);border-radius:8px;color:var(--teal);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;padding:7px 12px;cursor:pointer;text-decoration:none;transition:all .15s;}
  .back-btn:hover{background:rgba(0,232,187,.14);}
  .header-brand{font-family:'Playfair Display',serif;font-size:18px;font-weight:900;}
  .header-brand span{color:var(--teal);}
  .live-badge{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:700;letter-spacing:1.5px;color:var(--teal);}
  .live-dot{width:8px;height:8px;border-radius:50%;background:var(--teal);animation:pulse 2s infinite;}
  .live-dot.offline{background:var(--red);animation:none;}
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.4;transform:scale(.8);}}

  /* Selector */
  .selector-wrap{padding:16px 20px 0;max-width:960px;margin:0 auto;}
  .selector-label{font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--muted);margin-bottom:8px;text-transform:uppercase;}
  select.t-select{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;padding:11px 36px 11px 13px;appearance:none;cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2300e8bb' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 13px center;}
  .view-tabs{display:flex;gap:6px;margin-top:11px;flex-wrap:wrap;}
  .view-tab{padding:8px 13px;border-radius:8px;border:1.5px solid var(--border);background:var(--card);color:var(--muted);font-size:12px;font-weight:700;letter-spacing:.5px;cursor:pointer;transition:all .15s;}
  .view-tab.active{border-color:var(--teal);background:rgba(0,232,187,.1);color:var(--teal);}

  /* Main */
  .main{max-width:960px;margin:0 auto;padding:16px 20px 48px;}
  .t-title{margin-bottom:16px;}
  .t-name{font-family:'Playfair Display',serif;font-size:24px;font-weight:900;letter-spacing:-.5px;line-height:1.1;}
  .t-meta{font-size:12px;color:var(--muted);margin-top:4px;display:flex;gap:12px;flex-wrap:wrap;}

  /* Live leaderboard table */
  .lb-table{width:100%;border-collapse:collapse;font-size:14px;}
  .lb-table thead th{padding:9px 11px;text-align:left;font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--muted);border-bottom:1px solid var(--border);text-transform:uppercase;}
  .lb-table thead th.r{text-align:center;}
  .lb-table tbody tr{border-bottom:1px solid #161616;transition:background .12s;cursor:default;}
  .lb-table tbody tr:hover{background:#131313;}
  .lb-table tbody tr.leader{background:rgba(0,232,187,.03);}
  .lb-table td{padding:13px 11px;vertical-align:middle;}
  .lb-table td.r{text-align:center;}
  .rank-num{font-size:17px;font-weight:900;font-family:'Playfair Display',serif;}
  .r1{color:var(--gold);} .r2{color:#aaa;} .r3{color:#cd7f32;} .rn{color:#333;}
  .p-name{font-weight:700;font-size:15px;}
  .p-sub{font-size:11px;color:var(--muted);margin-top:2px;}
  .p-team{font-size:11px;font-weight:700;margin-top:2px;}
  .team-1{color:var(--teal);} .team-2{color:var(--red);}
  .score-big{font-size:21px;font-weight:900;font-family:'Playfair Display',serif;text-align:center;}
  .score-lbl{font-size:10px;color:var(--muted);text-align:center;margin-top:1px;letter-spacing:.5px;}
  .col-teal{color:var(--teal);} .col-red{color:var(--red);} .col-grey{color:#888;}
  .holes-wrap{text-align:center;}
  .holes-num{font-size:13px;color:var(--muted);}
  .holes-num.done{color:var(--gold);font-weight:700;}
  .holes-bar{width:50px;height:4px;background:#1e1e1e;border-radius:2px;margin:5px auto 0;overflow:hidden;}
  .holes-fill{height:100%;border-radius:2px;background:var(--teal);transition:width .5s;}
  .badge{display:inline-block;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700;letter-spacing:.5px;}
  .badge-live{background:rgba(0,232,187,.1);color:var(--teal);border:1px solid rgba(0,232,187,.3);}
  .badge-finished{background:rgba(226,184,74,.1);color:var(--gold);border:1px solid rgba(226,184,74,.3);}

  /* Hole detail */
  .hole-detail{display:none;padding:10px 12px;background:#0d0d0d;border-top:1px solid var(--border);}
  .hole-detail.open{display:block;}
  .hole-pips{display:flex;flex-wrap:wrap;gap:4px;}
  .pip{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;background:#1a1a1a;color:#444;position:relative;}
  .pip.scored{background:#132820;color:var(--teal);}
  .pip.next{border:1.5px solid rgba(0,232,187,.4);}
  .pip-n{position:absolute;top:2px;left:3px;font-size:7px;color:#333;font-weight:600;}

  /* Results ‚Äî singles */
  .standings-card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:14px;}
  .standings-header{background:linear-gradient(135deg,rgba(226,184,74,.12),rgba(0,232,187,.06));border-bottom:1px solid var(--border);padding:14px 16px;text-align:center;}
  .standings-header h2{font-family:'Playfair Display',serif;font-size:18px;font-weight:900;color:var(--gold);}
  .standings-header p{font-size:11px;color:var(--muted);margin-top:3px;letter-spacing:.5px;}
  .standings-row{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid #1a1a1a;gap:12px;}
  .standings-row:last-child{border-bottom:none;}
  .standings-rank{font-size:20px;min-width:28px;font-family:'Playfair Display',serif;font-weight:900;}
  .standings-info{flex:1;}
  .standings-name{font-weight:700;font-size:15px;}
  .standings-sub{font-size:11px;color:var(--muted);margin-top:2px;}
  .standings-score{text-align:right;}
  .standings-pts{font-size:22px;font-weight:900;font-family:'Playfair Display',serif;}
  .standings-pts-lbl{font-size:10px;color:var(--muted);letter-spacing:.5px;}

  /* Results ‚Äî teams */
  .teams-scoreboard{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:14px;}
  .teams-banner{background:linear-gradient(135deg,rgba(226,184,74,.1),rgba(0,232,187,.04));border-bottom:1px solid var(--border);padding:16px;text-align:center;}
  .teams-winner{font-family:'Playfair Display',serif;font-size:22px;font-weight:900;color:var(--gold);}
  .teams-grid{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:16px;gap:8px;}
  .team-col{text-align:center;}
  .team-name-lbl{font-size:11px;font-weight:700;letter-spacing:.5px;margin-bottom:4px;}
  .team-pts-big{font-family:'Playfair Display',serif;font-size:36px;font-weight:900;}
  .team-sub{font-size:11px;color:var(--muted);margin-top:4px;}
  .vs-divider{font-size:13px;color:var(--muted);font-weight:700;}
  .match-log-title{font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--muted);padding:10px 16px 6px;border-top:1px solid var(--border);text-transform:uppercase;}
  .match-log-row{display:flex;justify-content:space-between;align-items:flex-start;padding:10px 16px;border-bottom:1px solid #1a1a1a;gap:10px;}
  .match-log-row:last-child{border-bottom:none;}
  .match-date{font-size:11px;color:var(--muted);min-width:58px;}
  .match-players{font-size:12px;color:#aaa;flex:1;}
  .match-result{font-size:12px;font-weight:700;text-align:right;white-space:nowrap;}
  .res-t1{color:var(--teal);} .res-t2{color:var(--red);} .res-halved{color:var(--gold);}

  /* Empty / loading */
  .state-msg{text-align:center;padding:60px 20px;color:var(--muted);}
  .state-msg .icon{font-size:44px;margin-bottom:12px;}
  .state-msg h3{font-size:17px;font-weight:700;color:#555;margin-bottom:6px;}
  .state-msg p{font-size:13px;line-height:1.6;}
  .last-updated{text-align:center;font-size:11px;color:#2a2a2a;margin-top:20px;letter-spacing:.5px;}

  @keyframes rowIn{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}
  .row-in{animation:rowIn .3s ease forwards;}

  @media(max-width:600px){
    .header,.selector-wrap,.main{padding-left:14px;padding-right:14px;}
    .t-name{font-size:20px;} .score-big{font-size:18px;} .team-pts-big{font-size:28px;}
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <a class="back-btn" id="back-btn" href="index.html">‚Üê Scorecard</a>
    <div class="header-brand">Hill<span>fred</span></div>
  </div>
  <div class="live-badge">
    <div class="live-dot" id="live-dot"></div>
    <span id="live-lbl">CONNECTING</span>
  </div>
</div>

<div class="selector-wrap">
  <div class="selector-label">Tournament</div>
  <select class="t-select" id="t-select" onchange="onTournamentChange(this.value)">
    <option value="">‚Äî Select tournament ‚Äî</option>
  </select>
  <div class="view-tabs">
    <div class="view-tab active" id="vtab-live"    onclick="setView('live')">üì° Live Scores</div>
    <div class="view-tab"       id="vtab-results"  onclick="setView('results')">üèÜ Results</div>
    <div class="view-tab"       id="vtab-stab"     onclick="setView('stableford')">‚≠ê Stableford</div>
    <div class="view-tab"       id="vtab-stroke"   onclick="setView('stroke')">‚úèÔ∏è Stroke</div>
    <div class="view-tab"       id="vtab-match"    onclick="setView('matchplay')">üèÜ Matchplay</div>
  </div>
</div>

<div class="main" id="main-content">
  <div class="state-msg">
    <div class="icon">üèÜ</div>
    <h3>Live Leaderboard</h3>
    <p>Select a tournament above to see live scores and final results.</p>
  </div>
</div>
<div class="last-updated" id="last-updated"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBg_tfMOtzhcpMlTl-2o_2bfs0Dos8EHPM",
    authDomain: "hillfred-golf.firebaseapp.com",
    databaseURL: "https://hillfred-golf-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "hillfred-golf",
    storageBucket: "hillfred-golf.firebasestorage.app",
    messagingSenderId: "1047089194868",
    appId: "1:1047089194868:web:3f5fab20d2bc15154f2e21"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);

  let currentView = 'live';
  let currentKey  = '';
  let liveScores  = {};
  let liveResults = null;
  let unsubScores = null;
  let unsubResults = null;

  // Connection status
  onValue(ref(db, '.info/connected'), snap => {
    const on = snap.val() === true;
    document.getElementById('live-dot').className = 'live-dot' + (on ? '' : ' offline');
    document.getElementById('live-lbl').textContent = on ? 'LIVE' : 'OFFLINE';
  });

  // Populate tournament dropdown from Firebase
  onValue(ref(db, 'tournaments'), snap => {
    const data = snap.val() || {};
    const sel  = document.getElementById('t-select');
    const cur  = sel.value;
    const seen = new Set(Array.from(sel.options).map(o => o.value).filter(Boolean));
    Object.entries(data).forEach(([key, val]) => {
      if (seen.has(key)) return;
      const scores = val.scores || {};
      const meta   = Object.values(scores).map(g => g && g._meta).find(Boolean) || {};
      const lbl    = (val.results && val.results.label) || meta.tournamentLabel || key;
      const opt    = document.createElement('option');
      opt.value = key; opt.textContent = lbl;
      sel.appendChild(opt);
    });
    if (cur && data[cur]) sel.value = cur;
  });

  // Tournament change
  window.onTournamentChange = function(key) {
    currentKey = key;
    if (unsubScores)  { unsubScores();  unsubScores  = null; }
    if (unsubResults) { unsubResults(); unsubResults = null; }
    liveScores = {}; liveResults = null;

    // Update back link
    const base = window.location.href.replace(/[^/]*(\?.*)?$/, '');
    document.getElementById('back-btn').href = base + 'index.html';

    if (!key) {
      document.getElementById('main-content').innerHTML =
        `<div class="state-msg"><div class="icon">üèÜ</div><h3>Live Leaderboard</h3><p>Select a tournament above.</p></div>`;
      return;
    }

    document.getElementById('main-content').innerHTML =
      `<div class="state-msg"><div class="icon">‚è≥</div><h3>Loading‚Ä¶</h3></div>`;

    unsubScores = onValue(ref(db, `tournaments/${key}/scores`), snap => {
      liveScores = snap.val() || {};
      render();
    });
    unsubResults = onValue(ref(db, `tournaments/${key}/results`), snap => {
      liveResults = snap.val() || null;
      render();
    });
  };

  // View toggle
  window.setView = function(v) {
    currentView = v;
    ['live','results','stableford','stroke','matchplay'].forEach(id =>
      document.getElementById('vtab-' + id).classList.toggle('active', id === v)
    );
    render();
  };

  // Master render
  function render() {
    if (currentView === 'results') renderResults();
    else renderLive(currentView === 'live' ? 'all' : currentView);
    const ts = new Date().toLocaleTimeString('en-AU',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    document.getElementById('last-updated').textContent = `Last updated ${ts}`;
  }

  // ‚îÄ‚îÄ Live scores ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderLive(modeFilter) {
    const main = document.getElementById('main-content');
    const entries = [];

    Object.entries(liveScores).forEach(([gameId, gd]) => {
      if (!gd) return;
      const meta = gd._meta || {};
      Object.entries(gd).forEach(([pKey, pData]) => {
        if (pKey === '_meta' || !pData) return;
        if (modeFilter !== 'all' && meta.mode !== modeFilter) return;
        const hp   = pData.holesPlayed || 0;
        const last = hp > 0 ? (pData[`h${hp}`] || {}) : {};
        entries.push({
          gameId, name: pKey.replace(/_/g,' '), holesPlayed: hp,
          grossTotal: last.grossTotal||0, netTotal: last.netTotal||0,
          stabTotal: last.stabTotal||0, par: last.par||0,
          mode: meta.mode||last.mode||'‚Äî', team: last.team||false,
          teamName: last.teamName||null, mpStatus: last.mpStatus||null,
          status: meta.status||'active', course: meta.course||'‚Äî',
          tLabel: meta.tournamentLabel||currentKey,
          t1name: meta.team1name||'Team 1', t2name: meta.team2name||'Team 2',
          holeData: pData,
        });
      });
    });

    if (!entries.length) {
      main.innerHTML = `<div class="state-msg"><div class="icon">üì≠</div><h3>No scores yet</h3><p>Scores appear here once players complete holes.</p></div>`;
      return;
    }

    entries.sort((a,b) => a.mode==='stableford' ? b.stabTotal-a.stabTotal : a.netTotal-b.netTotal);

    const tLabel    = entries[0].tLabel;
    const activeCnt = entries.filter(e=>e.status==='active').length;
    const finCnt    = entries.filter(e=>e.status==='finished').length;

    let rows = '', rank = 1;
    entries.forEach((e, i) => {
      const rCls = rank===1?'r1':rank===2?'r2':rank===3?'r3':'rn';
      const tCls = e.teamName===e.t1name?'team-1':e.teamName===e.t2name?'team-2':'';
      const pct  = Math.round((e.holesPlayed/18)*100);

      let sh;
      if (e.mode==='stableford') {
        sh = `<div class="score-big col-teal">${e.stabTotal}</div><div class="score-lbl">PTS</div>`;
      } else if (e.mode==='matchplay') {
        const st=e.mpStatus||(e.holesPlayed===0?'AS':'‚Äî');
        const sc=st.includes('UP')?'col-teal':st==='AS'?'col-grey':'col-red';
        sh = `<div class="score-big ${sc}">${st}</div>`;
      } else {
        const d=e.netTotal-e.par;
        const sc=d<0?'col-teal':d>0?'col-red':'col-grey';
        sh = `<div class="score-big ${sc}">${d===0?'E':(d>0?'+':'')+d}</div><div class="score-lbl">NET ${e.netTotal}</div>`;
      }

      let pips='';
      for (let h=1;h<=18;h++){
        const hd=e.holeData[`h${h}`];
        const prv=h>1?e.holeData[`h${h-1}`]:null;
        const g=hd&&prv?hd.grossTotal-prv.grossTotal:(hd&&h===1?hd.grossTotal:null);
        const nxt=h===e.holesPlayed+1&&e.status==='active';
        pips+=`<div class="pip ${hd?'scored':''} ${nxt?'next':''}"><span class="pip-n">${h}</span>${g!=null?g:''}</div>`;
      }

      rows += `
        <tr class="${i===0?'leader':''} row-in" style="animation-delay:${i*.03}s" onclick="toggleDetail(${i})">
          <td><span class="rank-num ${rCls}">${rank}</span></td>
          <td>
            <div class="p-name">${e.name}</div>
            ${e.teamName?`<div class="p-team ${tCls}">${e.teamName}</div>`:''}
            <div class="p-sub">${e.course} ¬∑ ${e.mode}</div>
          </td>
          <td class="r">${sh}</td>
          <td><div class="holes-wrap"><div class="holes-num ${e.holesPlayed===18?'done':''}">${e.holesPlayed}/18</div><div class="holes-bar"><div class="holes-fill" style="width:${pct}%"></div></div></div></td>
          <td class="r"><span class="badge ${e.status==='finished'?'badge-finished':'badge-live'}">${e.status==='finished'?'‚úì Done':'‚óè Live'}</span></td>
        </tr>
        <tr><td colspan="5" style="padding:0">
          <div class="hole-detail" id="detail-${i}">
            <div style="font-size:10px;color:#444;margin-bottom:8px;letter-spacing:1px;font-weight:700">HOLE BY HOLE</div>
            <div class="hole-pips">${pips}</div>
          </div>
        </td></tr>`;

      if (i<entries.length-1){
        const nxt=entries[i+1];
        const tied=e.mode==='stableford'?e.stabTotal===nxt.stabTotal:e.netTotal===nxt.netTotal;
        if(!tied) rank=i+2;
      }
    });

    main.innerHTML = `
      <div class="t-title">
        <div class="t-name">${tLabel}</div>
        <div class="t-meta">
          <span>‚õ≥ ${entries.length} player${entries.length!==1?'s':''}</span>
          ${activeCnt?`<span style="color:var(--teal)">‚óè ${activeCnt} active</span>`:''}
          ${finCnt?`<span style="color:var(--gold)">‚úì ${finCnt} finished</span>`:''}
        </div>
      </div>
      <table class="lb-table">
        <thead><tr>
          <th style="width:34px">#</th><th>Player</th>
          <th class="r">Score</th><th class="r" style="width:74px">Holes</th>
          <th class="r" style="width:78px">Status</th>
        </tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
  }

  // ‚îÄ‚îÄ Results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderResults() {
    const main = document.getElementById('main-content');
    if (!liveResults) {
      main.innerHTML = `<div class="state-msg"><div class="icon">üìã</div><h3>No results yet</h3><p>Final results are stored here once rounds are saved in the scoring app.</p></div>`;
      return;
    }
    const r = liveResults;
    if (r.type==='singles') renderSinglesResults(main, r);
    else if (r.type==='teams') renderTeamsResults(main, r);
  }

  function renderSinglesResults(main, r) {
    const isStab = r.dominantMode==='stableford';
    const colLbl = isStab ? 'PTS' : 'NET';
    const lb = r.leaderboard || [];
    const rankEmoji = ['ü•á','ü•à','ü•â'];
    const rankColors = ['var(--gold)','#aaa','#cd7f32'];

    const rows = lb.map((p,i) => {
      const em  = rankEmoji[i]||(i+1)+'th';
      const col = rankColors[i]||'#555';
      const sc  = isStab ? p.stabTotal : p.netTotal;
      const avg = isStab ? p.avgStab   : p.avgNet;
      return `<div class="standings-row">
        <div class="standings-rank">${em}</div>
        <div class="standings-info">
          <div class="standings-name" style="color:${col}">${p.name}</div>
          <div class="standings-sub">${p.rounds} round${p.rounds!==1?'s':''} ¬∑ Avg ${avg}</div>
        </div>
        <div class="standings-score">
          <div class="standings-pts" style="color:${col}">${sc}</div>
          <div class="standings-pts-lbl">${colLbl}</div>
        </div>
      </div>`;
    }).join('');

    main.innerHTML = `
      <div class="standings-card">
        <div class="standings-header">
          <h2>${r.label}</h2>
          <p>${r.roundCount} round${r.roundCount!==1?'s':''} ¬∑ ${r.dominantMode}</p>
        </div>
        ${rows}
      </div>`;
  }

  function renderTeamsResults(main, r) {
    const winner = r.overallWinner;
    const winHtml = winner
      ? `<div class="teams-winner">üèÜ ${winner}</div><div style="font-size:12px;color:var(--muted);margin-top:4px">Overall Winner</div>`
      : `<div class="teams-winner" style="color:var(--gold)">All Square ‚Äî ${r.t1pts} all</div>`;

    const log = (r.matchResults||[]).map(m => {
      const rc = m.winner===1?'res-t1':m.winner===2?'res-t2':'res-halved';
      return `<div class="match-log-row">
        <div class="match-date">${m.date}</div>
        <div class="match-players">${m.t1players} vs ${m.t2players}<br>
          <span style="font-size:10px;color:#444">${m.mode} ¬∑ ${m.format} ¬∑ ${m.course}</span>
        </div>
        <div class="match-result ${rc}">${m.resultLabel}</div>
      </div>`;
    }).join('');

    main.innerHTML = `
      <div class="teams-scoreboard">
        <div class="teams-banner">${winHtml}</div>
        <div class="teams-grid">
          <div class="team-col">
            <div class="team-name-lbl" style="color:var(--teal)">${r.team1name}</div>
            <div class="team-pts-big" style="color:var(--teal)">${r.t1pts}</div>
            <div class="team-sub">${r.t1wins}W ¬∑ ${r.halved}H</div>
          </div>
          <div class="vs-divider">VS</div>
          <div class="team-col">
            <div class="team-name-lbl" style="color:var(--red)">${r.team2name}</div>
            <div class="team-pts-big" style="color:var(--red)">${r.t2pts}</div>
            <div class="team-sub">${r.t2wins}W ¬∑ ${r.halved}H</div>
          </div>
        </div>
        <div class="match-log-title">Match Results ¬∑ ${r.totalMatches} played</div>
        ${log}
      </div>`;
  }

  // Hole detail toggle
  window.toggleDetail = function(i) {
    const el = document.getElementById('detail-'+i);
    if (el) el.classList.toggle('open');
  };

  // Auto-select from URL param
  const urlP = new URLSearchParams(window.location.search);
  const tP = urlP.get('t');
  if (tP) {
    setTimeout(() => {
      const sel = document.getElementById('t-select');
      sel.value = tP;
      if (sel.value === tP) window.onTournamentChange(tP);
    }, 1500);
  }
</script>
</body>
</html>
